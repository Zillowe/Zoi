name: zoi
repo: main
versions:
  stable: https://gitlab.com/Zillowe/Zillwen/Zusty/Zoi/-/raw/main/app/version.json
  public: https://gitlab.com/Zillowe/Zillwen/Zusty/Zoi/-/raw/main/app/version.json
description: Universal Package Manager & Environment Setup Tool
website: https://gitlab.com/Zillowe/Zillwen/Zusty/Zoi
git: https://gitlab.com/Zillowe/Zillwen/Zusty/Zoi.git
maintainer:
  name: ZilloweZ
  email: zillowez@gmail.com
license: Apache-2.0
updater: script

installation:
  - type: com_binary
    url: https://gitlab.com/Zillowe/Zillwen/Zusty/Zoi/-/releases/{version}/downloads/zoi-{platform}.{platformComExt}
    platforms: [linux, macos, windows-amd64]
    checksums:
      url: https://gitlab.com/Zillowe/Zillwen/Zusty/Zoi/-/releases/{version}/downloads/checksums.txt

  - type: script
    url: "https://gitlab.com/Zillowe/Zillwen/Zusty/Zoi/-/raw/main/app/install.{platformExt}"
    platforms: [linux, macos, windows-amd64]
    checksums:
      url: https://gitlab.com/Zillowe/Zillwen/Zusty/Zoi/-/raw/main/app/checksums.txt

  - type: source
    url: "{git}"
    platforms: [all]
    commands:
      - ./configure --prefix={prefix}
      - make
      - sudo make install
      - make install-completions

post_install:
  - platforms: [linux, macos]
    commands:
      - "echo Installing shell completions for {name} {version}"
      - "{name} generate-completions bash > ~/.local/share/bash-completion/completions/{name} || true"
      - "{name} generate-completions zsh > ~/.zsh/completions/_{name} || true"
      - "{name} generate-completions fish > ~/.config/fish/completions/{name}.fish || true"
  - platforms: [windows-amd64]
    commands:
      - "echo Installing PowerShell profile completions for {name} {version}"
      - "powershell -NoProfile -Command \"$p=\"$env:USERPROFILE\\Documents\\PowerShell\"; if(!(Test-Path $p)){New-Item -ItemType Directory -Path $p|Out-Null}; {name}.exe generate-completions powershell >> \"$p\\Microsoft.PowerShell_profile.ps1\"\""

dependencies:
  runtime:
    - "native:git"

  build:
    - "native:rust"
    - "native:cargo"
    - "native:make"
    - "native:gcc"
    - "native:pkg-config"
    - "native:openssl-dev"
