---
title: Package Rollbacks
description: How to roll back a package to a previous version using Zoi.
---

Zoi includes a rollback feature that acts as a safety net, allowing you to quickly revert a package to its previously installed version. This is useful if an update introduces a bug or an unwanted change.

## Transactional Operations (Install/Update)

As of this release, installs and updates are performed transactionally. During a transaction (e.g. `zoi install a b c` or `zoi update --all`):

- Zoi snapshots the current state before making any changes.
- If any step in the operation fails, Zoi automatically rolls back all changes made during that operation.
- After a successful transaction, any old package versions are cleaned up according to your retention settings.

This prevents partially updated states when installing or upgrading multiple packages.

## How It Works

When you install or update a package that is already present on your system, Zoi automatically keeps at least the previously installed version available. For updates executed inside a transaction, cleanup of older versions is deferred until the transaction successfully completes.

The `zoi rollback` command still allows you to roll back a single package to its immediately previous version when available.

**Key Points:**

- A backup is only created when overwriting an existing installation.
- Only the most recent previous version is kept per package.
- During updates performed in a transaction, cleanup of old versions is deferred until commit to ensure a safe rollback path.

## Usage

To roll back a package, simply use the `rollback` command with the package name:

```sh
# Roll back the 'my-cli' package
zoi rollback my-cli
```

Zoi will:

1. Confirm that you want to proceed.
2. Switch the active version back to the previous one.
3. Re-create the necessary symlinks to make the command available in your shell.
4. Remove the failed/current version.

## Configuration

You can control the rollback behavior both globally and on a per-package basis.

### Global Configuration

To disable keeping an extra version for quick rollback, edit your Zoi config at `~/.zoi/pkgs/config.yaml` and add:

```yaml
# ~/.zoi/pkgs/config.yaml
rollback_enabled: false
```

If the file or key doesn't exist, you can add it.

### Per-Package Configuration

A package author can disable rollbacks for their specific package by adding the `rollback` field to the `.pkg.lua` file and setting it to `false`.

```lua
-- my-package.pkg.lua
package({
  name = "my-package",
  version = "1.2.0",
  -- ... other fields
  rollback = false -- Disables rollback backups for this package
})
```

This setting will override the global configuration.

## Limitations

The rollback feature is designed for quick recovery, not for managing multiple versions of a package.

- It only stores **one** previous version per package.
- To lock a package to a specific version and prevent it from being updated, use the [`zoi pin`](/docs/zds/zoi) command instead.
